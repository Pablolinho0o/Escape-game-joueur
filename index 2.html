<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carnaval MystÃ©rieux Pro</title>

<style>
body{
    margin:0;
    font-family:Georgia, serif;
    text-align:center;
    color:white;
    background: url('https://images.unsplash.com/photo-1603481540822-df0409c2adf6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w5NjA4fDB8MHwxfGFsbHwxfHx2ZW5ldGlhJTIwbWFza3xlbnwwfHx8fDE2OTg3MzY1ODF&ixlib=rb-4.0.3&q=80&w=1080') no-repeat center center fixed;
    background-size: cover;
    overflow:hidden;
}

/* BOITE DE JEU */
#box{
    background: rgba(0,0,0,0.45);
    padding:20px;
    border-radius:15px;
    max-width:500px;
    margin:auto;
    margin-top:20px;
    backdrop-filter:blur(6px);
}
button{
    background:gold;
    border:none;
    padding:12px;
    width:100%;
    font-size:18px;
    margin-top:10px;
    border-radius:10px;
    font-weight:bold;
}
input{
    padding:10px;
    font-size:18px;
    width:100%;
    border-radius:10px;
    border:none;
    margin-top:10px;
}

/* CHRONO */
#chrono{
    font-size:28px;
    text-shadow:0 0 10px gold;
}

/* MASQUE ANIMÃ‰ */
#mask{
    width:120px;
    margin:auto;
    animation:floatMask 3s ease-in-out infinite;
}
@keyframes floatMask{
    0%{transform:translateY(0);}
    50%{transform:translateY(-10px);}
    100%{transform:translateY(0);}
}

/* FAUX STRESS VISUEL */
@keyframes glitch{
    0%{transform:translate(0);}
    20%{transform:translate(-2px,2px);}
    40%{transform:translate(2px,-2px);}
    60%{transform:translate(-1px,1px);}
    80%{transform:translate(1px,-1px);}
    100%{transform:translate(0);}
}
.glitch{
    animation:glitch 0.2s;
}
</style>
</head>

<body>

<h1>ðŸŽ­ Carnaval MystÃ©rieux ðŸŽ­</h1>

<img id="mask" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Venetian_mask.svg/512px-Venetian_mask.svg.png">

<div id="start">
    <input id="teamName" placeholder="Nom de l'Ã©quipe">
    <button onclick="start()">Entrer au Bal</button>
</div>

<div id="game" style="display:none;">
    <h2 id="chrono">00:00</h2>
    <div id="box">
        <p id="question"></p>
        <input id="rep" placeholder="Mot secret">
        <button onclick="check()">Valider</button>
        <p id="msg"></p>
    </div>
</div>

<!-- MUSIQUE -->
<audio id="music" loop>
    <source src="https://cdn.pixabay.com/audio/2022/10/13/audio_39b6ff92bb.mp3" type="audio/mpeg">
</audio>

<script>
// ðŸ”¥ ENIGMES
let enigmes = [
    {q:"Accessoire emblÃ©matique du carnaval ?", r:"1"},
    {q:"Ville du cÃ©lÃ¨bre carnaval ?", r:"1"},
    {q:"Moment magique oÃ¹ tout disparaÃ®t ?", r:"1"}
];
enigmes.sort(()=>Math.random()-0.5);

let sec = 0, timer, index = 0, equipe = "";

// START GAME
function start(){
    equipe = document.getElementById("teamName").value;
    if(!equipe){ alert("Entrez un nom d'Ã©quipe"); return; }

    // Musique sÃ©curisÃ©e mobile
    let music = document.getElementById("music");
    music.muted=true;
    music.play().then(()=>{music.muted=false;}).catch(()=>{});

    document.getElementById("start").style.display="none";
    document.getElementById("game").style.display="block";

    // ðŸ”¥ Charger progression si existante
    let prog = JSON.parse(localStorage.getItem("escapeProgress")||"{}");
    if(prog[equipe]){
        index = prog[equipe].index;
        sec = prog[equipe].sec;
    } else {
        index = 0;
        sec = 0;
    }

    load();

    timer = setInterval(()=>{
        sec++;
        updateChrono();
        randomStress();
        // Sauvegarde progression
        let p = JSON.parse(localStorage.getItem("escapeProgress")||"{}");
        p[equipe] = {index:index, sec:sec};
        localStorage.setItem("escapeProgress", JSON.stringify(p));
    },1000);
}

// CHRONO
function updateChrono(){
    let m=Math.floor(sec/60), s=sec%60;
    document.getElementById("chrono").textContent=
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

// CHARGER ENIGME
function load(){
    document.getElementById("question").textContent = enigmes[index].q;
    document.getElementById("rep").value = "";
    document.getElementById("msg").textContent = "";
}

// VERIFIER REPONSE
function check(){
    let rep = document.getElementById("rep").value.toUpperCase();
    if(rep === enigmes[index].r){
        index++;
        if(index < enigmes.length){ load(); }
        else{ finish(); }
    } else {
        document.getElementById("msg").textContent = "âŒ Mauvaise rÃ©ponse";
        document.body.classList.add("glitch");
        setTimeout(()=>{document.body.classList.remove("glitch");},200);
    }
}

// FIN DU JEU
function finish(){
    clearInterval(timer);
    let temps = document.getElementById("chrono").textContent;

    // Sauvegarde rÃ©sultat
    let results = JSON.parse(localStorage.getItem("escapeResults")||"[]");
    results.push({team:equipe,time:temps});
    localStorage.setItem("escapeResults", JSON.stringify(results));

    // Supprime progression
    let prog = JSON.parse(localStorage.getItem("escapeProgress")||"{}");
    delete prog[equipe];
    localStorage.setItem("escapeProgress", JSON.stringify(prog));

    document.body.innerHTML=`
        <h1>ðŸŽ­ MystÃ¨re terminÃ© !</h1>
        <p>Temps final : ${temps}</p>
        <p>Ã‰quipe : ${equipe}</p>
        <p>Attendez l'annonce du MaÃ®tre du Jeu</p>
    `;
}

// Faux stress visuel
function randomStress(){
    if(Math.random()<0.15){
        document.body.classList.add("glitch");
        setTimeout(()=>{document.body.classList.remove("glitch");},200);
    }
}

// Mode maÃ®tre du jeu (touche M)
document.addEventListener("keydown",function(e){
    if(e.key==="m"){
        alert("ðŸ˜ˆ Mode MaÃ®tre du Jeu activÃ©");
        finish();
    }
});
</script>
</body>
</html>
